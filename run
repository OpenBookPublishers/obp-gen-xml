#!/bin/bash

set -e
cd $(dirname $0)/XML-last

echo "running XML-before-transformation.py"
python2.7 XML-before-transformation.py

echo "running Transform-to-XML-section.xsl"
saxonb-xslt -s:Transform-to-XML-section.xsl -xsl:Transform-to-XML-section.xsl -o:Transform-to-XML-section.xsl -ext:on

# Create a zip archive of the XML edition
find . -name '*.zip' | while read file; do
    filename=$(basename -- ${file%.*})
    zip -rq ${filename}.xml.zip XML-edition/

    echo "created ./XML-edition/${filename}.xml.zip"
done
